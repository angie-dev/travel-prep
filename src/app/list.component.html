<mat-expansion-panel>
    <mat-expansion-panel-header>
        <mat-panel-title>
            Load
        </mat-panel-title>
        <mat-panel-description>
            Load a template or an existing list
        </mat-panel-description>
    </mat-expansion-panel-header>
    <div fxLayout="row" fxFlexGaps="10px" fxLayoutAlign="end center" fxFlexFill>
        <div fxFlexAlign="start center" fxFlex>
            <mat-form-field>
                    <mat-select placeholder="Pick list" [(ngModel)]="selectedList" name="saved_list">
                        <mat-option *ngFor="let saved_list of saved_lists" [value]="saved_list">{{ saved_list }}</mat-option>
                    </mat-select>
            </mat-form-field>
            <span>&nbsp;|&nbsp;Selected list : {{ selectedList }}</span>
        </div>
        <div fxFlexAlign="end center">
            <button mat-raised-button color="accent" [disabled]="!selectedList" (click)="loadList(selectedList)">Load List</button>
        </div>
    </div>
</mat-expansion-panel>

<div>&nbsp;</div>
<div>&nbsp;</div>

<div *ngIf="list">
    <div fxFlexFill fxLayout="row" fxFlexGaps="20px" fxLayoutAlign="space-between center">
        <span fxFlexAlign="start center" fxFlex>
            My List:
            <span class="pointer" *ngIf="!editmode" (click)="editmode=true">
                {{ list.name }}
                <mat-icon style="vertical-align: bottom">edit</mat-icon>
            </span>
            <span *ngIf="editmode">
                <input matInput matTextareaAutosize matAutosizeMinRows="1" [(ngModel)]="list.name">
                <mat-icon style="vertical-align: bottom" class="pointer" (click)="editmode=false">done</mat-icon>
            </span>
        </span>
        <span fxFlexAlign="end center">
            Save To: <input [(ngModel)]="list_name">.json
            <button mat-raised-button color="accent" [disabled]="!list_name" (click)="res = saveList(list_name)">Save List</button>
        </span>
    </div>
</div>

<div>&nbsp;</div>

<div fxLayout="row" fxFlexFill *ngIf="list">
    <mat-card fxFlex="33">
        <mat-card-header>
            <mat-icon mat-card-avatar color="primary">looks_one</mat-icon>
            <mat-card-title>Choose</mat-card-title>
            <mat-card-subtitle>Select needed items</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <div>
                <input matInput placeholder="New Category..." [(ngModel)]="new_category.name">
                <mat-icon style="vertical-align: bottom" class="pointer" (click)="addCat(new_category.name)">add</mat-icon>
            </div>
            <span>&nbsp;</span>
            <mat-divider></mat-divider>
            <span>&nbsp;</span>
            <div *ngFor="let cat of list.categories; let i = index; trackBy: trackByFn">
                <span class="category">
                <mat-checkbox [(ngModel)]="cat.take" (change)="toggleAll(i, cat.take)"></mat-checkbox>
                    <span class="pointer">
                        <span *ngIf="!cat.editmode">
                            {{cat?.name}}
                            <mat-icon style="vertical-align: bottom" (click)="cat.editmode=true">edit</mat-icon>
                        </span>
                        <span *ngIf="cat.editmode">
                            <input matInput [(ngModel)]="cat.name">
                            <mat-icon style="vertical-align: bottom" class="pointer" (click)="cat.editmode=false;cat.item_add=false">done</mat-icon>
                            <mat-icon style="vertical-align: bottom" (click)="deleteCat(i)">delete</mat-icon>
                            <mat-icon style="vertical-align: bottom" (click)="cat.item_add = true">add</mat-icon>
                        </span>
                        <mat-icon style="vertical-align: bottom" (click)="cat.list = !cat.list" *ngIf="cat.list">expand_less</mat-icon>
                        <mat-icon style="vertical-align: bottom" (click)="cat.list = !cat.list" *ngIf="!cat.list">expand_more</mat-icon>
                    </span>

                </span>
                <mat-selection-list class="item-list" *ngIf="!cat.list">
                        <mat-list-option *ngFor="let item of cat.items; let j = index; trackBy: trackByFn" [value]="item.name" [selected]="item.take" [disabled]="cat.editmode" checkboxPosition="before" (selectionChange)="changeEvent(i, j)">
                        <span class="item-name" *ngIf="!cat.editmode">
                            {{item.name}}
                        </span>
                        <span *ngIf="cat.editmode">
                            <input matInput [(ngModel)]="item.name">
                            <mat-icon style="vertical-align: bottom" (click)="deleteItem(i, j)">delete</mat-icon>
                        </span>
                        </mat-list-option>
                </mat-selection-list>
                <span *ngIf="cat.item_add">
                    <input matInput placeholder="New Item..." [(ngModel)]="new_item.name">
                    <input matInput placeholder="Default action..." [(ngModel)]="new_item.default_action">
                    <mat-icon style="vertical-align: bottom" class="pointer" (click)="addItem(i, new_item.name, new_item.default_action)">done</mat-icon>
                </span>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-card fxFlex="33">
        <mat-card-header>
            <mat-icon mat-card-avatar color="primary">looks_two</mat-icon>
            <mat-card-title>Pack</mat-card-title>
            <mat-card-subtitle>Verify and pack</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <div *ngFor="let cat of list?.categories; let i = index; trackBy: trackById">
                <span class="category" *ngIf="cat.has_items">
                    {{cat.name}}
                </span>
                <mat-list *ngIf="cat.has_items" class="item-list">
                    <mat-list-item *ngFor="let item of filterTake(i)">
                        <div fxLayout="row" fxFlexFill fxFlexGaps="10px" fxLayoutAlign="space-around center">
                            <span class="item" fxFlexAlign="start center" fxFlex>
                                <mat-checkbox [(ngModel)]="item.pack" fxFlex="grow">
                                <span class="item-name">{{item.name}}</span>
                                </mat-checkbox>
                            </span>
                            <span fxFlexAlign="end center">
                                <mat-checkbox [(ngModel)]="item.act" fxFlex="auto"></mat-checkbox>
                                <span fxFlex>&nbsp;&nbsp;</span>
                                <input matInput [(ngModel)]="item.default_action">
                            </span>
                        </div>
                    </mat-list-item>
                </mat-list>
            </div>
        </mat-card-content>
    </mat-card>

    <mat-card fxFlex="34" fxLayout="column">
        <mat-card-header>
            <mat-icon mat-card-avatar color="primary">looks_3</mat-icon>
             <mat-card-title>TODO</mat-card-title>
            <mat-card-subtitle>Go get things done</mat-card-subtitle>
        </mat-card-header>
       <mat-card-content fxFlex>
            <div *ngFor="let cat of list.categories; let i = index">
                <mat-list *ngIf="cat.has_items" class="item-list">
                    <mat-list-item *ngFor="let item of filterDo(i)">
                        <span class="item">
                        <mat-checkbox [(ngModel)]="item.done" fxFlex="grow" >
                            {{item.default_action}}&nbsp;{{item.name}}
                        </mat-checkbox>
                        </span>
                    </mat-list-item>
                </mat-list>
            </div>
       </mat-card-content>

       <mat-card-content fxFlex fxLayout="column">
        <div fxLayoutAlign="start end">
            <mat-list class="item-list">
                <mat-list-item *ngFor="let action of list.custom_actions; let a=index">
                    <span *ngIf="!action?.edit">
                        <span class="item">
                        <mat-checkbox>{{action?.name}}</mat-checkbox>
                        </span>
                        <mat-icon class="pointer" (click)="action.edit = true">edit</mat-icon>
                        <mat-icon class="pointer" (click)="removeCustomAction(a)">delete</mat-icon>
                    </span>
                    <span *ngIf="action?.edit">
                        <input matInput [(ngModel)]="list.custom_actions[a].name">
                        <mat-icon class="pointer" (click)="action.edit = false">done</mat-icon>
                    </span>
                </mat-list-item>
            </mat-list>
        </div>
        <div style="width: 100%" fxLayoutAlign="start end">
           <input matInput style="width: 100%" placeholder="Add other stuff to do" [(ngModel)]="new_action">
           <mat-icon class="pointer" (click)="addCustomAction(new_action)">add</mat-icon>
        </div>
       </mat-card-content>
    </mat-card>
</div>